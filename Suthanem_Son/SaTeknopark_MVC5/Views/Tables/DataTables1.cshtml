
@{
    ViewBag.Title = "Cariler";
}

<div class="row wrapper border-bottom white-bg page-heading">
  
    <div class="col-lg-2">

    </div>
</div>
<div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox ">
                <div class="ibox-title ">
                    <button onclick="Temizle()" style='background-color:dimgray;color:white' type="button" class="btn-white btn btn-xs" data-toggle="modal" data-target="#UyeOl">
                        Yeni Cari Hesap
                    </button>
                   
                    <div  class="modal inmodal " id="UyeOl" tabindex="-1" role="dialog" aria-labelledby="">
                        <div class="modal-dialog modal-lg" role="document">
                            <div  class="modal-content animated bounceInRight">
                                <div class="modal-header">
                                    <a  style="text-align:left; color:white" class="btn btn-danger btn-xs" id="myModalLabel">CARİ KARTI</a>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">×</span>
                                    </button>
                                   
                                </div>
                                <form id="veri" method="post" action="/Tables/YeniCari">
                                    <div class="modal-body">


                                        <div class="row">
                                            <div class="col-md-5 px-1">
                                                <div class="form-group">
                                                    <label><b>Firma Adı</b></label>
                                                    <input style="background-color:lightgoldenrodyellow" id="CariU" name="CariU" type="text" class="form-control" value="">
                                                </div>
                                            </div>
                                            <div class="col-md-3 px-1">
                                                <div class="form-group">
                                                    <label>Firma Kodu</label>
                                                    <input id="FirmaK" name="FirmaK" type="text" class="form-control" value="">
                                                </div>
                                            </div>
                                            <div class="col-md-4 px-1">
                                                <div class="form-group">
                                                    <label for="exampleInputEmail1">Email</label>
                                                    <input id="EPos" name="EPos" type="email" class="form-control" value="">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-5 px-1">
                                                <div class="form-group">
                                                    <label>Yetkili</label>
                                                    <input id="Yetkili" name="Yetkili" type="text" class="form-control" value="">
                                                </div>
                                            </div>
                                            <div class="col-md-3 px-1">
                                                <div class="form-group">
                                                    <label>VergiNo/Tckn</label>
                                                    <input id="VergiNo" name="VergiNo" type="text" class="form-control" value="">
                                                </div>
                                            </div>
                                            <div class="col-md-4 px-1">
                                                <div class="form-group">
                                                    <label>Vergi Dairesi</label>
                                                    <input id="VergiDr" name="VergiDr" type="text" class="form-control" value="">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-8 px-1">
                                                <div class="form-group">
                                                    <input id="Adres" name="Adres" type="text" class="form-control" placeholder="Adres" value="">
                                                </div>
                                            </div>
                                            <div class="col-md-4 px-1">
                                                <div class="form-group">
                                                    <input id="Il" name="Il" type="text" class="form-control" placeholder="Şehir" value="">
                                                </div>
                                            </div>
                                            <div class="col-md-12 px-1">
                                                <div class="form-group">
                                                    <input id="EkBilgi" name="EkBilgi" type="text" class="form-control" placeholder="Aciklama" value="">
                                                </div>
                                            </div>

                                        </div>
                                        <div class="row">
                                            <div class="col-md-4 px-1">
                                                <div class="form-group">
                                                    <input id="PostaKodu" name="PostaKodu" type="text" class="form-control" placeholder="PostaKodu" value="">
                                                </div>
                                            </div>
                                            <div class="col-md-4 px-1">
                                                <div class="form-group">
                                                    <input id="Gsm" name="Gsm" type="text" class="form-control" placeholder="GSM" value="">
                                                </div>
                                            </div>
                                            <div class="col-md-4 px-1">
                                                <div class="form-group">
                                                    <input id="Telefon1" name="Telefon1" type="text" class="form-control" placeholder="Sabit" value="">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-4 px-1">
                                                <div class="form-group">
                                                    @Html.DropDownList("KTip", new List<SelectListItem>
                                                    {
                                                        new SelectListItem { Text="MÜŞTERİ", Value="MÜŞTERİ", Selected=@ViewBag.bayi == true ? false : true },
                                                        new SelectListItem { Text="TOPTANCI", Value="TOPTANCI"},
                                                        new SelectListItem { Text="ALICI-SATICI", Value="ALICI-SATICI"},
                                                        new SelectListItem { Text="BAYİİ", Value="BAYİİ" , Selected=@ViewBag.bayi == true ? true : false },
                                                        new SelectListItem { Text="TEDARİKÇİ", Value="TEDARİKÇİ"},
                                                        new SelectListItem { Text="PAZARLAMACI", Value="PAZARLAMACI"},
                                                        new SelectListItem { Text="YÖNETİCİ", Value="YÖNETİCİ"},
                                                    }, new
                                                    {
                                                       @id = "KTip",
                                                       @class = "form-control",
                                                       @style = "background-color:#F9E79F"
                                                    })
                                                </div>
                                            </div>

                                            <div class="col-md-4 px-1">
                                                <div class="form-group">
                                                    @Html.DropDownList("StokFG", new List<SelectListItem>
                                                    {
                                                        new SelectListItem { Text="1.Fiyat", Value="1.Fiyat", Selected=true},
                                                        new SelectListItem { Text="2.Fiyat", Value="2.Fiyat"},
                                                        new SelectListItem { Text="3.Fiyat", Value="3.Fiyat" },
                                                        new SelectListItem { Text="4.Fiyat", Value="4.Fiyat"},
                                                        new SelectListItem { Text="5.Fiyat", Value="5.Fiyat"},
                                                    }, new
                                                    {
                                                        @id = "StokFG",
                                                        @class = "form-control",
                                                        @style = "background-color:#F9E79F"
                                                    })
                                                </div>
                                            </div>
                                            
                                            <div class="col-md-4 px-1">
                                                <div class="form-group">
                                                    <input id="CariGrubu" name="CariGrubu" type="text" class="form-control" placeholder="Grubu" value="">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3 px-1">
                                            <div class="form-group">
                                                @Html.Hidden("cID", -1)
                                            </div>
                                        </div>

                                    </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-default" data-dismiss="modal">Kapat</button>
                                                <button type="submit" class="btn btn-primary">Kaydet</button>
                                            </div>
</form>
                            </div>
                        </div>
                    </div>


                    <h5>&nbsp; Cari Listesini görüntülemektesiniz</h5>
                
                    <div class="ibox-tools">
                        <a class="collapse-link">
                            <i class="fa fa-chevron-up"></i>
                        </a>
                        <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                            <i class="fa fa-wrench"></i>
                        </a>
                        <ul class="dropdown-menu dropdown-user">
                            <li>
                                <a href="#" class="dropdown-item">Config option 1</a>
                            </li>
                            <li>
                                <a href="#" class="dropdown-item">Config option 2</a>
                            </li>
                        </ul>
                        <a class="close-link">
                            <i class="fa fa-times"></i>
                        </a>
                    </div>
                </div>
                <div class="ibox-content">

                    <table class="table table-striped table-bordered dt-responsive nowrap dataTables-example">
                        <thead>
                            <tr>
                                <th>Firma Kodu</th>
                                <th>Cari Ünvan</th>
                                <th>Grubu</th>
                                <th>Bakiye</th>
                                <th>Satış F2</th>
                                <th>Müşteri Tipi</th>
                                <th> </th>
                                <th> </th>

                            </tr>
                        </thead>
                      
                    </table>

                </div>
            </div>
        </div>
    </div>
   
</div>

@section Styles {
    @Styles.Render("~/Content/plugins/dataTables/dataTablesStyles")
}

@section Scripts {
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>

<link href="https://cdn.datatables.net/1.10.15/css/dataTables.bootstrap.min.css" rel="stylesheet" />
<link href="https://cdn.datatables.net/responsive/2.1.1/css/responsive.bootstrap.min.css" rel="stylesheet" />

<script src="https://cdn.datatables.net/1.10.15/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.15/js/dataTables.bootstrap4.min.js "></script>


<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/7.2.0/sweetalert2.all.min.js"></script>
<script src="~/Scripts/mask.js"></script>
<script src="~/Scripts/musteri.js"></script>
<script src="~/Content/datatables.js"></script>
    <script type="text/javascript">

        var oTable;

        function Goster(id) {

          

            $.ajax({
                type: "GET",
                url: '@Url.Action("CariBilgi", "Tables")/' + id,
                success: function (gt) {
                    if (gt.success) {
                        $("#cID").val(gt.data.ID);
                        $("#FirmaK").val(gt.data.FirmaKodu);
                        $("#CariU").val(gt.data.CariUnvan);
                        $("#Il").val(gt.data.Il);
                        $("#EkBilgi").val(gt.data.EkBilgi);
                        $("#Adres").val(gt.data.Adres);
                        $("#EPos").val(gt.data.EPosta);
                        $("#Gsm").val(gt.data.Gsm);
                        $("#Telefon1").val(gt.data.Telefon1);
                        $("#KTip").val(gt.data.KTipi);
                        $("#StokFG").val(gt.data.StokFG);
                        $("#CariGrubu").val(gt.data.CariGrubu);
                        $("#VergiDr").val(gt.data.VergiDr);
                        $("#VergiNo").val(gt.data.VergiNo);
                        $("#PostaKodu").val(gt.data.PostaKodu);
                        $("#Yetkili").val(gt.data.Yetkili);

                        $('#UyeOl').modal('show');
                    }
                }

            });

   
        }



        function Goster2(id) {
            window.location.href = "/Tables/CariHareketler?id=" + id;

        }

        function Temizle() {

            $("#cID").val("-1");
            $("#FirmaK").val("");
            $("#CariU").val("");
            $("#Il").val("");
            $("#EkBilgi").val("");
            $("#Adres").val("");
            $("#EPos").val("");
            $("#Gsm").val("");
            $("#Telefon1").val("");
            $("#KTip").val("MÜŞTERİ");
            $("#StokFG").val("1.Fiyat");
            $("#CariGrubu").val("");
            $("#VergiDr").val("");
            $("#VergiNo").val("");
            $("#PostaKodu").val("");
            $("#Yetkili").val("");
        }

        function Delete(id) {

            swal({
                title: "[Silme Onayı]",
                text: "Seçili müşteriyi silmek istediğinizden emin misiniz?",
                icon: "warning",
                dangerMode: true,
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                cancelButtonText: "Hayır",
                confirmButtonText: "Evet",
                closeOnCancel: true,
                closeOnConfirm: true,

                preConfirm: function () {
                    $.ajax({
                        type: "POST",
                        url: '@Url.Action("DeleteCari", "Tables")/' + id,
                        success: function (data) {
                            if (data.success) {
                                oTable.ajax.reload();
                                Temizle();
                            }
                        }

                    });
                }

            })
        }


        $("#veri").on("submit", function (event) {
            event.preventDefault();

            var obj = {
                id: $("#cID").val(),
                FirmaKodu: $("#FirmaK").val(),
                CariUnvan: $("#CariU").val(),
                Il: $("#Il").val(),
                EkBilgi: $("#EkBilgi").val(),
                Adres: $("#Adres").val(),
                EPosta: $("#EPos").val(),
                Gsm: $("#Gsm").val(),
                Telefon1: $("#Telefon1").val(),
                KTipi: $("#KTip").val(),
                StokFG: $("#StokFG").val(),
                CariGrubu: $("#CariGrubu").val(),
                VergiDr: $("#VergiDr").val(),
                VergiNo: $("#VergiNo").val(),
                PostaKodu: $("#PostaKodu").val(),
                Yetkili: $("#Yetkili").val(),
            };


            $.ajax({
                type: "POST",
                url: '/Tables/YeniCari',
                data: obj,
                dataType: "json",
                success: function (gelenDeg) {

                    if (gelenDeg.sonuc == "0")
                        swal("Uyarı", gelenDeg.Message, "warning");
                    else if (gelenDeg.sonuc == "3")
                        swal("Hata", gelenDeg.Message, "error");
                    else if (gelenDeg.sonuc == "1") {
                        swal("Başarılı", gelenDeg.Message, "success");
                        {
                            $('#UyeOl').modal('hide');
                            Temizle();
                            setTimeout(oTable.ajax.reload(), 300)

                        }

                    }

                },
                error: function () {
                    swal("Hata", "Kayıt Eklenirken Hata Oluştu!", "error");
                }
            });
        });




        $(document).ready(function () {

            oTable = $('.dataTables-example').DataTable({
                "scrollX": true,
                pageLength: 25,
                'columnDefs': [
                 {
                     "targets": 2,
                     "className": "text-right",
                 }],
                "ajax": {
                    "url": "/Tables/GetGorusme",
                    "type": "GET",
                    "datatype": "json",
                },

                dom: '<"html5buttons"B>lTfgitp',
                "columns": [

                   { "data": "FirmaKodu", "visible": false },
                     { "data": "CariUnvan" },
                   { "data": "CariGrubu" },                 
                    { "data": "Bakiye", render: $.fn.dataTable.render.number('.', ',', 2, ''), className: "text-right" },
                    { "data": "SatisF2", render: $.fn.dataTable.render.number('.', ',', 2, ''), className: "text-right" },
                   { "data": "KTipi" },
                   { "data": "ID", "visible": false },


                   {
                       "data": null, "render": function (data, type, row) {

                           return " <div class='btn-group'> " +
                               "<a onclick=Goster2(" + row.ID + ") style='background-color:darkturquoise;color:white' class='btn-white btn btn-xs'>Gör</a>" +
                               "<a onclick=Goster(" + row.ID + ") style='background-color:#f0ad4e;color:black' class='btn-white btn btn-xs'>Düzenle</a>" +
                               "<a onclick=Delete(" + row.ID + ") style='background-color:indianred;color:white' class='btn-white btn btn-xs'>Sil</a></div>" +
                               "</div>";

                       },

                   },

                ],

                "language": {
                    "sDecimal": ",",
                    "sEmptyTable": "Tabloda herhangi bir veri mevcut değil",
                    "sInfo": "_TOTAL_ kayıttan _START_ - _END_ arasındaki kayıtlar gösteriliyor",
                    "sInfoEmpty": "Kayıt yok",
                    "sInfoFiltered": "(_MAX_ kayıt içerisinden bulunan)",
                    "sInfoPostFix": "",
                    "sInfoThousands": ".",
                    "sLengthMenu": "Sayfada _MENU_ kayıt göster",
                    "sLoadingRecords": "Yükleniyor...",
                    "sProcessing": "İşleniyor...",
                    "sSearch": "Ara:",
                    "sZeroRecords": "Eşleşen kayıt bulunamadı",
                    "oPaginate": {
                        "sFirst": "İlk",
                        "sLast": "Son",
                        "sNext": "Sonraki",
                        "sPrevious": "Önceki"
                    },
                    "oAria": {
                        "sSortAscending": ": artan sütun sıralamasını aktifleştir",
                        "sSortDescending": ": azalan sütun sıralamasını aktifleştir"
                    },
                    "select": {
                        "rows": {
                            "_": "%d kayıt seçildi",
                            "0": "",
                            "1": "1 kayıt seçildi"
                        }
                    }
                },
                buttons: [
                    { extend: 'copy' },
                    { extend: 'csv' },
                    { extend: 'excel', title: 'ExampleFile' },
                    { extend: 'pdf', title: 'ExampleFile' },

                    {
                        extend: 'print',
                        customize: function (win) {
                            $(win.document.body).addClass('white-bg');
                            $(win.document.body).css('font-size', '10px');

                            $(win.document.body).find('table')
                                    .addClass('compact')
                                    .css('font-size', 'inherit');
                        }
                    }
                ]

            });



        });

    </script>
}